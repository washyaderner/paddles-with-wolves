---
/**
 * LocationMap Component
 * Illustrated Pacific Northwest location map with mystical overlay
 */

interface Props {
  locationTitle?: string;
  generalArea?: string;
  showDetails?: boolean;
}

const {
  locationTitle = "Our Healing Space",
  generalArea = "Pacific Northwest",
  showDetails = true
} = Astro.props;
---

<section class="location-map-section">
  <div class="map-header">
    <h2 class="map-title text-gradient-forest">{locationTitle}</h2>
    <p class="map-subtitle">Serving the {generalArea} region</p>
  </div>

  <div class="map-container glass">
    <!-- Illustrated Map -->
    <div class="illustrated-map">
      <!-- Pacific Northwest Illustrated Map SVG -->
      <svg
        class="map-svg"
        viewBox="0 0 600 400"
        xmlns="http://www.w3.org/2000/svg"
        role="img"
        aria-label="Pacific Northwest region illustrated map"
      >
        <!-- Ocean/Water Background -->
        <defs>
          <linearGradient id="oceanGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#2D5F7E;stop-opacity:0.6" />
            <stop offset="100%" style="stop-color:#1A3A4F;stop-opacity:0.8" />
          </linearGradient>

          <linearGradient id="landGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#3A5A40;stop-opacity:0.7" />
            <stop offset="100%" style="stop-color:#2C4A32;stop-opacity:0.9" />
          </linearGradient>

          <linearGradient id="mountainGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#6B7A8F;stop-opacity:0.9" />
            <stop offset="100%" style="stop-color:#4A5568;stop-opacity:1" />
          </linearGradient>

          <!-- Glow filter -->
          <filter id="glow">
            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- Ocean -->
        <rect width="600" height="400" fill="url(#oceanGradient)" />

        <!-- Pacific Ocean waves (decorative) -->
        <path
          d="M 0 250 Q 100 240 200 250 Q 300 260 400 250 Q 500 240 600 250 L 600 400 L 0 400 Z"
          fill="url(#oceanGradient)"
          opacity="0.4"
        />

        <!-- Washington State (simplified) -->
        <path
          d="M 150 80 L 180 75 L 250 70 L 320 75 L 380 85 L 420 100 L 450 120 L 470 150 L 475 180 L 470 210 L 450 240 L 420 255 L 380 260 L 320 258 L 260 255 L 200 250 L 160 240 L 130 220 L 110 190 L 100 150 L 110 110 L 130 90 Z"
          fill="url(#landGradient)"
          stroke="#588157"
          stroke-width="2"
          opacity="0.8"
        />

        <!-- Oregon (simplified) -->
        <path
          d="M 160 245 L 200 255 L 260 260 L 320 263 L 380 265 L 440 268 L 480 275 L 500 290 L 510 315 L 505 340 L 485 360 L 450 370 L 400 372 L 340 370 L 280 365 L 220 358 L 170 345 L 140 325 L 125 300 L 125 270 Z"
          fill="url(#landGradient)"
          stroke="#588157"
          stroke-width="2"
          opacity="0.7"
        />

        <!-- Cascade Mountains -->
        <g class="mountains" opacity="0.9">
          <!-- Mt. Rainier -->
          <path
            d="M 320 140 L 340 100 L 360 140 Z"
            fill="url(#mountainGradient)"
            stroke="#F8F8F8"
            stroke-width="1.5"
          />
          <path
            d="M 340 100 L 345 90 L 350 100 Z"
            fill="#F8F8F8"
            opacity="0.9"
          />

          <!-- Mt. Hood -->
          <path
            d="M 350 280 L 365 250 L 380 280 Z"
            fill="url(#mountainGradient)"
            stroke="#F8F8F8"
            stroke-width="1.5"
          />
          <path
            d="M 365 250 L 368 242 L 371 250 Z"
            fill="#F8F8F8"
            opacity="0.9"
          />

          <!-- Other peaks -->
          <path d="M 240 160 L 250 140 L 260 160 Z" fill="url(#mountainGradient)" opacity="0.8" />
          <path d="M 290 120 L 300 105 L 310 120 Z" fill="url(#mountainGradient)" opacity="0.8" />
          <path d="M 400 180 L 410 165 L 420 180 Z" fill="url(#mountainGradient)" opacity="0.7" />
        </g>

        <!-- Puget Sound -->
        <path
          d="M 280 90 Q 290 110 295 130 Q 298 145 290 160 Q 285 170 275 165 Q 268 160 265 145 Q 262 130 270 110 Z"
          fill="#4A90A4"
          opacity="0.6"
        />

        <!-- Columbia River -->
        <path
          d="M 150 260 Q 200 262 250 263 Q 300 264 350 266 Q 400 268 450 272"
          stroke="#4A90A4"
          stroke-width="4"
          fill="none"
          opacity="0.7"
        />

        <!-- Pine Trees (scattered) -->
        <g class="trees" opacity="0.6">
          <path d="M 180 200 L 185 185 L 190 200 Z M 185 195 L 185 210" stroke="#2C4A32" stroke-width="1.5" fill="#3A5A40" />
          <path d="M 230 220 L 235 205 L 240 220 Z M 235 215 L 235 230" stroke="#2C4A32" stroke-width="1.5" fill="#3A5A40" />
          <path d="M 420 230 L 425 215 L 430 230 Z M 425 225 L 425 240" stroke="#2C4A32" stroke-width="1.5" fill="#3A5A40" />
          <path d="M 200 300 L 205 285 L 210 300 Z M 205 295 L 205 310" stroke="#2C4A32" stroke-width="1.5" fill="#3A5A40" />
          <path d="M 380 320 L 385 305 L 390 320 Z M 385 315 L 385 330" stroke="#2C4A32" stroke-width="1.5" fill="#3A5A40" />
        </g>

        <!-- Location Marker (General PNW area) -->
        <g class="location-marker" filter="url(#glow)">
          <circle cx="300" cy="200" r="8" fill="#FDB462" opacity="0.3">
            <animate
              attributeName="r"
              values="8;12;8"
              dur="2s"
              repeatCount="indefinite"
            />
          </circle>
          <circle cx="300" cy="200" r="5" fill="#FDB462" />
          <path
            d="M 300 185 Q 295 190 295 195 Q 295 200 300 205 Q 305 200 305 195 Q 305 190 300 185 Z"
            fill="#FF8C42"
            stroke="#FDB462"
            stroke-width="1.5"
          />
          <circle cx="300" cy="192" r="2" fill="#FFFFFF" />
        </g>

        <!-- City Labels (stylized) -->
        <text x="285" y="125" font-family="var(--font-heading)" font-size="11" fill="#FDB462" opacity="0.8">Seattle</text>
        <text x="340" y="285" font-family="var(--font-heading)" font-size="11" fill="#FDB462" opacity="0.8">Portland</text>

        <!-- Compass Rose -->
        <g class="compass" transform="translate(540, 60)" opacity="0.7">
          <circle cx="0" cy="0" r="25" fill="none" stroke="#FDB462" stroke-width="1.5" />
          <!-- North -->
          <path d="M 0 -20 L -5 -10 L 0 -25 L 5 -10 Z" fill="#FDB462" />
          <text x="-3" y="-27" font-family="var(--font-heading)" font-size="12" fill="#FDB462">N</text>
          <!-- Other directions (simplified) -->
          <line x1="0" y1="-15" x2="0" y2="-25" stroke="#FDB462" stroke-width="2" />
          <line x1="0" y1="15" x2="0" y2="20" stroke="#FDB462" stroke-width="1" opacity="0.6" />
          <line x1="15" y1="0" x2="20" y2="0" stroke="#FDB462" stroke-width="1" opacity="0.6" />
          <line x1="-15" y1="0" x2="-20" y2="0" stroke="#FDB462" stroke-width="1" opacity="0.6" />
        </g>
      </svg>

      <!-- Map Overlay Info -->
      <div class="map-overlay">
        <div class="location-pulse"></div>
        <div class="location-info">
          <span class="info-label">üìç General Area</span>
          <span class="info-value">{generalArea}</span>
        </div>
      </div>
    </div>

    <!-- Location Details -->
    {showDetails && (
      <div class="location-details">
        <div class="detail-item">
          <div class="detail-icon">üèîÔ∏è</div>
          <div class="detail-content">
            <h4>Pacific Northwest</h4>
            <p>Serving Seattle, Portland, and surrounding areas</p>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">üè°</div>
          <div class="detail-content">
            <h4>In-Person & Virtual</h4>
            <p>Studio sessions available in-person, or connect virtually from anywhere</p>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">üöó</div>
          <div class="detail-content">
            <h4>Easy Access</h4>
            <p>Exact address provided upon booking confirmation</p>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">üå≤</div>
          <div class="detail-content">
            <h4>Nature-Immersed</h4>
            <p>Surrounded by old-growth forests and mountain views</p>
          </div>
        </div>
      </div>
    )}
  </div>
</section>

<style>
  .location-map-section {
    width: 100%;
  }

  /* Map Header */
  .map-header {
    text-align: center;
    margin-bottom: var(--space-8);
  }

  .map-title {
    font-size: clamp(2rem, 4vw, 2.5rem);
    margin-bottom: var(--space-3);
  }

  .map-subtitle {
    font-size: var(--text-base);
    color: var(--medium-gray);
    font-style: italic;
  }

  /* Map Container */
  .map-container {
    padding: var(--space-8);
    border-radius: var(--radius-2xl);
    border: 1px solid rgba(107, 70, 193, 0.3);
  }

  /* Illustrated Map */
  .illustrated-map {
    position: relative;
    width: 100%;
    margin-bottom: var(--space-8);
    border-radius: var(--radius-xl);
    overflow: hidden;
    background: rgba(15, 23, 42, 0.4);
    border: 2px solid rgba(107, 70, 193, 0.2);
  }

  .map-svg {
    width: 100%;
    height: auto;
    display: block;
  }

  .location-marker {
    cursor: pointer;
    transition: transform var(--transition-base);
  }

  .location-marker:hover {
    transform: scale(1.1);
  }

  /* Map Overlay */
  .map-overlay {
    position: absolute;
    bottom: var(--space-4);
    left: var(--space-4);
    z-index: 2;
  }

  .location-pulse {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 20px;
    background: var(--sunset-gold);
    border-radius: 50%;
    opacity: 0.6;
    animation: pulse 2s ease-out infinite;
  }

  @keyframes pulse {
    0% {
      transform: translateX(-50%) scale(1);
      opacity: 0.6;
    }
    50% {
      transform: translateX(-50%) scale(1.5);
      opacity: 0.3;
    }
    100% {
      transform: translateX(-50%) scale(1);
      opacity: 0.6;
    }
  }

  .location-info {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    padding: var(--space-3) var(--space-4);
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(8px);
    border: 1px solid rgba(107, 70, 193, 0.4);
    border-radius: var(--radius-lg);
  }

  .info-label {
    font-size: var(--text-xs);
    color: var(--medium-gray);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-wide);
  }

  .info-value {
    font-size: var(--text-base);
    color: var(--sunset-gold);
    font-weight: var(--font-weight-semibold);
  }

  /* Location Details */
  .location-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-4);
  }

  .detail-item {
    display: flex;
    gap: var(--space-3);
    padding: var(--space-4);
    background: rgba(15, 23, 42, 0.4);
    border: 1px solid rgba(107, 70, 193, 0.2);
    border-radius: var(--radius-lg);
    transition: all var(--transition-base);
  }

  .detail-item:hover {
    border-color: var(--sunset-gold);
    transform: translateY(-2px);
    box-shadow: var(--shadow-glow-purple);
  }

  .detail-icon {
    font-size: 2rem;
    flex-shrink: 0;
  }

  .detail-content h4 {
    font-size: var(--text-base);
    color: var(--sunset-gold);
    margin: 0 0 var(--space-1) 0;
    font-family: var(--font-heading);
  }

  .detail-content p {
    font-size: var(--text-sm);
    color: var(--light-gray);
    line-height: var(--line-height-relaxed);
    margin: 0;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .map-container {
      padding: var(--space-6);
    }

    .location-details {
      grid-template-columns: 1fr;
    }

    .map-overlay {
      bottom: var(--space-2);
      left: var(--space-2);
    }

    .location-info {
      font-size: var(--text-xs);
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .location-pulse,
    .location-marker circle,
    .detail-item {
      animation: none;
      transition: none;
    }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  function initLocationMap() {
    const mapSvg = document.querySelector('.map-svg');
    const detailItems = document.querySelectorAll('.detail-item');

    // Animate map on scroll
    if (mapSvg) {
      gsap.from(mapSvg, {
        scrollTrigger: {
          trigger: mapSvg,
          start: 'top bottom-=100',
          toggleActions: 'play none none none',
        },
        opacity: 0,
        scale: 0.95,
        duration: 0.8,
        ease: 'power3.out'
      });
    }

    // Animate detail items
    detailItems.forEach((item, index) => {
      gsap.from(item, {
        scrollTrigger: {
          trigger: item,
          start: 'top bottom-=50',
          toggleActions: 'play none none none',
        },
        opacity: 0,
        y: 30,
        duration: 0.5,
        delay: index * 0.1,
        ease: 'power3.out'
      });
    });

    // Add hover effect to location marker
    const locationMarker = document.querySelector('.location-marker');
    locationMarker?.addEventListener('click', () => {
      gsap.fromTo(locationMarker,
        { scale: 1 },
        {
          scale: 1.2,
          duration: 0.3,
          yoyo: true,
          repeat: 1,
          ease: 'power2.inOut'
        }
      );
    });
  }

  // Initialize map
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLocationMap);
  } else {
    initLocationMap();
  }

  // Re-initialize on navigation
  document.addEventListener('astro:page-load', initLocationMap);
</script>
