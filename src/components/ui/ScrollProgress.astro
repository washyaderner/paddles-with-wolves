---
/**
 * Scroll Progress Indicator
 * Fixed at top of page showing reading progress
 */
---

<div class="scroll-progress-container">
  <div class="scroll-progress-bar" id="scroll-progress-bar"></div>
</div>

<style>
  .scroll-progress-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(15, 23, 42, 0.8);
    z-index: var(--z-sticky);
    pointer-events: none;
  }

  .scroll-progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,
      var(--mystic-purple) 0%,
      var(--sunset-gold) 50%,
      var(--forest-green) 100%);
    background-size: 200% 100%;
    animation: gradient-shift 3s ease-in-out infinite;
    box-shadow: 0 0 10px rgba(107, 70, 193, 0.6),
                0 0 20px rgba(253, 180, 98, 0.4);
    transition: width 0.1s ease-out;
    transform-origin: left center;
  }

  @keyframes gradient-shift {
    0%, 100% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .scroll-progress-bar {
      animation: none;
      background: var(--mystic-purple);
    }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  function initScrollProgress() {
    const progressBar = document.getElementById('scroll-progress-bar');
    if (!progressBar) return;

    // Use GSAP for smooth progress updates
    gsap.to(progressBar, {
      width: '100%',
      ease: 'none',
      scrollTrigger: {
        trigger: 'body',
        start: 'top top',
        end: 'bottom bottom',
        scrub: 0.3, // Smooth scrubbing
        invalidateOnRefresh: true,
      }
    });
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initScrollProgress);
  } else {
    initScrollProgress();
  }

  // Re-initialize on Astro navigation
  document.addEventListener('astro:page-load', initScrollProgress);
</script>
