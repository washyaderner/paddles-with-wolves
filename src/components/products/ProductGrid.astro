---
import ProductCard from './ProductCard.astro';

interface Product {
  id: string;
  name: string;
  category: string;
  type: string;
  price: number;
  size: string;
  description: string;
  ingredients: string[];
  benefits: string[];
  usage: string;
  botanicalIcon: string;
  stripeProductId: string;
}

interface Props {
  products: Product[];
}

const { products } = Astro.props;
---

<section class="product-grid-section">
  <div class="container">
    <div class="product-grid" id="product-grid">
      {products.map((product, index) => (
        <div class="product-grid-item" data-index={index}>
          <ProductCard
            id={product.id}
            name={product.name}
            category={product.category}
            type={product.type}
            price={product.price}
            size={product.size}
            description={product.description}
            ingredients={product.ingredients}
            benefits={product.benefits}
            usage={product.usage}
            botanicalIcon={product.botanicalIcon}
            stripeProductId={product.stripeProductId}
          />
        </div>
      ))}
    </div>

    {products.length === 0 && (
      <div class="empty-state">
        <div class="empty-icon">ðŸŒ¿</div>
        <h3>No products found</h3>
        <p>Try selecting a different category</p>
      </div>
    )}
  </div>
</section>

<style>
  .product-grid-section {
    padding: var(--space-8) 0 var(--space-32) 0;
    min-height: 600px;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-8);
    width: 100%;
  }

  .product-grid-item {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.6s ease forwards;
  }

  /* Stagger animation delays */
  .product-grid-item:nth-child(1) { animation-delay: 0.1s; }
  .product-grid-item:nth-child(2) { animation-delay: 0.15s; }
  .product-grid-item:nth-child(3) { animation-delay: 0.2s; }
  .product-grid-item:nth-child(4) { animation-delay: 0.25s; }
  .product-grid-item:nth-child(5) { animation-delay: 0.3s; }
  .product-grid-item:nth-child(6) { animation-delay: 0.35s; }
  .product-grid-item:nth-child(7) { animation-delay: 0.4s; }
  .product-grid-item:nth-child(8) { animation-delay: 0.45s; }
  .product-grid-item:nth-child(9) { animation-delay: 0.5s; }
  .product-grid-item:nth-child(10) { animation-delay: 0.55s; }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: var(--space-20) var(--space-8);
  }

  .empty-icon {
    font-size: 5rem;
    margin-bottom: var(--space-6);
    filter: grayscale(50%);
    opacity: 0.5;
  }

  .empty-state h3 {
    font-size: var(--text-2xl);
    color: var(--light-gray);
    margin-bottom: var(--space-3);
    font-family: var(--font-heading);
  }

  .empty-state p {
    font-size: var(--text-base);
    color: var(--medium-gray);
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .product-grid {
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: var(--space-6);
    }
  }

  @media (max-width: 768px) {
    .product-grid-section {
      padding: var(--space-6) 0 var(--space-20) 0;
    }

    .product-grid {
      grid-template-columns: 1fr;
      gap: var(--space-6);
      max-width: 500px;
      margin: 0 auto;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .product-grid-item {
      animation: none;
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  function initProductGrid() {
    const gridItems = document.querySelectorAll('.product-grid-item');

    if (!gridItems.length) return;

    // Animate items on scroll for better performance
    gridItems.forEach((item, index) => {
      gsap.from(item, {
        scrollTrigger: {
          trigger: item,
          start: 'top bottom-=100',
          toggleActions: 'play none none none',
        },
        opacity: 0,
        y: 50,
        duration: 0.6,
        delay: index * 0.05,
        ease: 'power2.out',
      });
    });

    // Dispatch event when products are loaded
    window.dispatchEvent(new CustomEvent('productsLoaded'));
  }

  // Initialize grid
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProductGrid);
  } else {
    initProductGrid();
  }

  // Re-initialize on navigation
  document.addEventListener('astro:page-load', initProductGrid);
</script>
